# blockchain-hub

Cryptocurrencies have exploded in growth in the past few years with the cummaltive market cap of cryptocurrencies reaching close to 2 Trillion Dollars. Tapped within this speculative assets is vast amounts of data that can be analyzed to bring huge buisness value. In this project, we collect upto-date on chain data from ethereum which is one the most popular cryptocurrencies. We attempt to divide these datasets on basis of blocks,transactions,tokens,token_transferred and contracts. We have outlined our exploration of the datasets below, in subsequent weeks we will be performing analysis on the data. 

Our dataset is divided into multiple files and is availale [here](https://storage.googleapis.com/ethereum-bigdata/)


# Background

## Blockchain

A blockchain is essentially a chain-like data structure consisting of a number of consecutively-connected blocks. The chain has been maintained by all the peers in a peer-to-peer blockchain network. In a period of time, only one block can be confirmed by the entire blockchain network through a consensus protocol. The block containing the confirmed transactions at that time and the hash value, of the previous block has been generated by a peer (a.k.a.miner).After being generated, the block will be validatedindependently by the other peers. Once the block is validated and confirmed by most of peers in the blockchain network, the transactions in the block will be considered as completed. In this way, each peer can trust the whole blockchain (a.k.a. ledger) since the transactions have been validated by all the peers. In other words, blockchain enhances trustworthiness of transactional data through duplicating computation and storage at all the peers.

## Smart Contracts

Smart contracts is a term used to describe computer code that automatically executes all or parts of an agreement and is stored on a blockchain-based platform. The code can either be the sole manifestation of the agreement between the parties or might complement a traditional text-based contract and execute certain provisions, such as transferring funds from Party A to Party B. The code itself is replicated across multiple nodes of a blockchain and, therefore, benefits from the security, permanence and immutability that a blockchain offers. That replication also means that as each new block is added to the blockchain, the code is, in effect, executed. If the parties have indicated, by initiating a transaction, that certain parameters have been met, the code will execute the step triggered by those parameters. If no such transaction has been initiated, the code will not take any steps. Most smart contracts are written in one of the programming languages directly suited for such computer programs, such as Solidity.

## Tokens

Ethereum has two standard token protocols (a.k.a. templates) of smart contracts namely ERC-20 and ERC-721(also known as non-fungible tokens or NFTs). These token protocols define the standard variables, functions, and interfaces in the smart contract. With the protocols, users can issue tokens (or so-called cryptocurrencies) based on smart contracts on top of Ethereum. 

A user can publish an ERC20 contract on Ethereum issuing tokens to others. After that, any other users (even contracts) can receive or send the token without a centralized authority (e.g., stock exchange). The standard token protocols greatly enrich the ecosystem of Ethereum so as to make Ethereum
become a more flexible financial system

# Data Collection

One of the biggest challenges in big data analaytics of blockchain data is in collection of the data. Due to the the bulky size of blockchain, it takes a long time to fully synchronize the entire blockchain at a node (i.e a peer). With the exponential growth of ethereum the blockchain size is close to 800gb of raw transaction data. The task of storing and accuring this large amount of data impedes the big data analysis of blockchain data.

Thankfully, a tool called [`ethereum-etl`](https://github.com/blockchain-etl/ethereum-etl) has been developed that sets up a local-node and can quickly retrieve blockchain data in convenient formats like CSVs and relational databases. However, running this tool for the period 2019-2021, generates over 200gb of data making it difficult to upload to any cloud platform for analysis.           

Google uses [`ethereum-etl`](https://github.com/blockchain-etl/ethereum-etl) to make the ethereum dataset available in their sets of public dataset in BigQuery. We used BigQuery in our Data wrangling process to filter out the data due to 3 reasons:

- Running ethereum-etl will take significantly more time to produce the same formatted data.
- We can remove unnecessary data and reduce the size of the data before downloading for processing. 
- Direct export to Google cloud storage

One of our inital aims was to understand the effects of covid on the ethereum ecosystem and we divided our data propotionally in that respect. We chose four time slices of 2 months each, namely
- pre-covid (2019-11-01 to 2020-01-01)
- onset-covid (2020-03-01 to 2020-05-01)
- mid-covid (2020-07-01 to 2020-09-01) 
- vaccine-stimulus-elections (2020-11-01 to 2021-01-01)           

We attempt to understand their effects on the network.


# Data Structure and Data Wrangling

The data is structured into the following files when exported from `ethereum-etl`:

- blocks
- transactions
- token_transfers
- contracts
- tokens

Each table has the following Attributes

## Blocks

Block data is directly stored in Ethereum blockchain. block consists of the following fields

```
timestamp		    The timestamp for when the block was collated       
number			    The block number       
hash			    Hash of the block     
parent_hash		    Hash of the parent block        
nonce		        Hash of the generated proof-of-work     
sha3_uncles	        SHA3 of the uncles data in the block
logs_bloom		    The bloom filter for the logs of the block
transactions_root	The root of the transaction trie of the block
state_root		    The root of the final state trie of the block
receipts_root		The root of the receipts trie of the block
miner		        The address of the beneficiary to whom the mining rewards were given
difficulty		    Integer of the difficulty for this block
total_difficulty	Integer of the total difficulty of the chain until this block
size	            The size of this block in bytes
extra_data	        The extra data field of this block
gas_limit	        The maximum gas allowed in this block
gas_used	        The total used gas by all transactions in this block
transaction_count	The number of transactions in the block
``` 

We can only obtain little information about the blockchain users through analyzing the block data. This is
because the input of block transaction only represents operations to EVM(ethereum virtual machine) in the contract deployment phase while the contract code will be stored only at the end of the
transaction(transaction table) execution.

### Queries
To obtain the data from 2019-11-01 we used the following query in BigQuery
```
SELECT * 
FROM `bigquery-public-data.crypto_ethereum.blocks` AS blocks 
WHERE DATE(blocks.timestamp) > "2019-11-01" 
```
Resulting in `3.4GB` of data


## Transactions

Transactions are cryptographically signed instructions from accounts. An account will initiate a transaction to update the state of the Ethereum network. The simplest transaction is transferring ethereum from one account to another.   

Each block in the blockchain is composed of zero or more transactions. Each transaction has a source address, a target address, an amount of Ether transferred, and an array of input bytes.
This table contains a set of all transactions from all blocks

```
hash		                    Hash of the transaction
nonce		                    The number of transactions made by the sender prior to this one
transaction_index	            Integer of the transactions index position in the block
from_address	                Address of the sender
to_address			            Address of the receiver. null when its a contract creation transaction
value			                Value transferred in Wei
gas			                    Gas provided by the sender
gas_price			            Gas price provided by the sender in Wei
input			                The data sent along with the transaction
receipt_cumulative_gas_used	    The total amount of gas used when this transaction was executed in the block
receipt_gas_used	            The amount of gas used by this specific transaction alone
receipt_contract_address	    The contract address created, if the transaction was a contract creation,   
                                otherwise null
receipt_root		            32 bytes of post-transaction stateroot (pre Byzantium)
receipt_status	                Either 1 (success) or 0 (failure) (post Byzantium)
block_timestamp		            Timestamp of the block where this transaction was in
block_number	                Block number where this transaction was in
block_hash                      Hash of the block where this transaction was in
```

### Queries

We have identified the block_hash and input to be irelevant in future processing. The block number can uniquely identify the block apart from the hash and the input is in EVM bytecode that can be processed only by the EVM,

#### To obtain the data from pre-covid we used the following queries in BigQuery.

```
SELECT * except (block_hash,input)
FROM `bigquery-public-data.crypto_ethereum.transactions` AS transactions
WHERE DATE(transactions.block_timestamp) > "2019-11-01" and DATE(transactions.block_timestamp) < "2020-01-01"
```
Resulting in `8.63 GB` of data     

#### To obtain the data from onset-covid we used the following queries in BigQuery.

```
SELECT * except (block_hash,input)
FROM `bigquery-public-data.crypto_ethereum.transactions` AS transactions
WHERE DATE(transactions.block_timestamp) > "2020-03-01" and DATE(transactions.block_timestamp) < "2020-05-01" 
```

Resulting in `10.3 GB` of data

#### To obtain the data from mid-covid we used the following queries in BigQuery.

```
SELECT * except (block_hash,input)
FROM `bigquery-public-data.crypto_ethereum.transactions` AS transactions
WHERE DATE(transactions.block_timestamp) > "2020-07-01" and DATE(transactions.block_timestamp) < "2020-09-01" 
```

Resulting in `15.8 GB` of data

#### To obtain the data from vaccine-stimulus-elections we used the following queries in BigQuery.

```
SELECT * except (block_hash,input)
FROM `bigquery-public-data.crypto_ethereum.transactions` AS transactions
WHERE DATE(transactions.block_timestamp) > "2020-11-01" and DATE(transactions.block_timestamp) < "2021-01-01"
```

Resulting in `15.6 GB` of data  


## token_transfers
The most popular type of transaction on the Ethereum blockchain invokes a contract of type ERC20 to perform a transfer operation, moving some number of tokens from one 20-byte address to another 20-byte address.
This table contains the subset of those transactions

```
token_address		ERC20 token address
from_address		Address of the sender
to_address		    Address of the receiver
value		        Amount of tokens transferred (ERC20) 
transaction_hash	Transaction hash
log_index	        Log index in the transaction receipt
block_timestamp	    Timestamp of the block where this transfer was in
block_number	    Block number where this transfer was in
block_hash	        Hash of the block where this transfer was in
```

### Queries   

We have identified the block_hash to be irelevant in future processing. The block number can uniquely identify the block apart from the hash.

#### To obtain the data from pre-covid we used the following queries in BigQuery.

```
SELECT * except (block_hash)
FROM `bigquery-public-data.crypto_ethereum.token_transfers` AS token_transfer
WHERE DATE(token_transfer.block_timestamp) > "2019-11-01" and DATE(token_transfer.block_timestamp) < "2020-01-01"
```
Resulting in `9.01 GB` of data     

#### To obtain the data from onset-covid we used the following queries in BigQuery.

```
SELECT * except (block_hash)
FROM `bigquery-public-data.crypto_ethereum.token_transfers` AS token_transfer
WHERE DATE(token_transfer.block_timestamp) > "2020-03-01" and DATE(token_transfer.block_timestamp) < "2020-05-01" 
```

Resulting in `6.69 GB` of data

#### To obtain the data from mid-covid we used the following queries in BigQuery.

```
SELECT * except (block_hash)
FROM `bigquery-public-data.crypto_ethereum.token_transfers` AS token_transfer
WHERE DATE(token_transfer.block_timestamp) > "2020-07-01" and DATE(token_transfer.block_timestamp) < "2020-09-01" 
```

Resulting in `9.69 GB` of data

#### To obtain the data from vaccine-stimulus-elections we used the following queries in BigQuery.

```
SELECT * except (block_hash)
FROM `bigquery-public-data.crypto_ethereum.token_transfers` AS token_transfer
WHERE DATE(token_transfer.block_timestamp) > "2020-11-01" and DATE(token_transfer.block_timestamp) < "2021-01-01" 
```

Resulting in `12.2 GB` of data          

## contracts

Some transactions create smart contracts from their input bytes, and this smart contract is stored at a particular 20-byte address.
This table contains a subset of Ethereum addresses that contain contract byte-code.       

```
address		            Address of the contract
bytecode	            Bytecode of the contract
function_sighashes		4-byte function signature hashes
is_erc20	            Whether this contract is an ERC20 contract
is_erc721	            Whether this contract is an ERC721 contract
block_timestamp	        Timestamp of the block where this contract was created
block_number	        Block number where this contract was created
block_hash	            Hash of the block where this contract was created
```      

### Queries   

We have identified the block_hash to be irelevant in future processing. The block number can uniquely identify the block apart from the hash. The function_signature is also irrelevant, since it just gives a hash value that points to the functions inside the byte code, which can only be processed by the EVM.

#### To obtain the data from pre-covid we used the following queries in BigQuery.

```
SELECT * except(function_sighashes,block_hash) 
FROM `bigquery-public-data.crypto_ethereum.contracts` AS contracts 
WHERE DATE(contracts.block_timestamp) > "2019-11-01" and DATE(contracts.block_timestamp) < "2020-01-01"
```
Resulting in `1.17 GB` of data     

#### To obtain the data from onset-covid we used the following queries in BigQuery.

```
SELECT * except(function_sighashes,block_hash) 
FROM `bigquery-public-data.crypto_ethereum.contracts` AS contracts 
WHERE DATE(contracts.block_timestamp) > "2020-03-01" and DATE(contracts.block_timestamp) < "2020-05-01"
```

Resulting in `1.27 GB` of data.

#### To obtain the data from mid-covid we used the following queries in BigQuery.

```
SELECT * except(function_sighashes,block_hash) 
FROM `bigquery-public-data.crypto_ethereum.contracts` AS contracts 
WHERE DATE(contracts.block_timestamp) > "2020-07-01" and DATE(contracts.block_timestamp) < "2020-09-01"
```

Resulting in `1.62 GB` of data.

#### To obtain the data from vaccine-stimulus-elections we used the following queries in BigQuery.

```
SELECT * except(function_sighashes,block_hash) 
FROM `bigquery-public-data.crypto_ethereum.contracts` AS contracts 
WHERE DATE(contracts.block_timestamp) > "2020-11-01" and DATE(contracts.block_timestamp) < "2021-01-01"
```

Resulting in `1.41 GB` of data.           

## tokens
These are all the erc20 tokens, along with their name and attributes

```
address	            The address of the ERC20 token
symbol	            The symbol of the ERC20 token
name	            The name of the ERC20 token
decimal	            The number of decimals the token uses. Use safe_cast for casting to NUMERIC or FLOAT64
total_supply		The total token supply. Use safe_cast for casting to NUMERIC or FLOAT64
block_timestamp	    Timestamp of the block where this token was created
block_number	    Block number where this token was created
block_hash	        Hash of the block where this token was created
```       

### Queries

We have identified the block_hash to be irelevant in future processing. The block number can uniquely identify the block apart from the hash.  


#### To obtain the data from 2019-11-01 we used the following query in BigQuery

```
SELECT * except (block_hash)
FROM `bigquery-public-data.crypto_ethereum.tokens` AS tokens
WHERE DATE(tokens.block_timestamp) > "2019-11-01" 
```
Resultuing in `33 MB` of data.

# Further Cleaning

All of the data is now available on our [GCP buckets](https://storage.googleapis.com/ethereum-bigdata/) which is public at the moment. to access any file, you can just append the key to the base url above. 

Since the data originates from a blockchain which is immutabale by nature there is non existant human errors in the data since it is all generated by the EVM. There are some value which are null like in `receipt_contract_address` of the `transactions` table indicating that this transaction is not a contract creation. In such a scenario, we decided to keep the values null instead of assigning a default value since, that would be considered an address(while its not).

# Future Work

Going Forward we plan on exploring the data in more detail and try and answer the following questions:

- The effect of covid on transactions (frequency and amount).
- The effect of vaccines, stimulus checks and elections on transactions.
- ERC-20 tokens and their trends.
- ERC-721 tokens and their trends as form of ownerships.
- understanding scams and phishing in ethereum.
